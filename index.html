



# owncloud
参考:https://hub.docker.com/_/owncloud/

no189
```
docker run -v /data/owncloud-192.168.8.68:/var/www/html -v /etc/localtime:/etc/localtime -v :/var/www/html/config --restart=always -itd -p 8000:80 owncloud
```
说明:
使用的sqlite
使用的8.89的共享存储


# mysql配置
启动:
```
cat /root/dockerfile/mysql/start.sh
docker run  -p 3306:3306 -v /data/mysql:/var/lib/mysql -v /etc/localtime:/etc/localtime --name mysql5 --restart=always -d mysql:5.6.23 --character-set-server=utf8 --collation-server=utf8_general_ci
```


```
docker run  -p 3306:3306 -v /data/mysql:/var/lib/mysql -v /etc/localtime:/etc/localtime -v /data/mysql/my.cnf:/etc/my.cnf --name mysql5 --restart=always -d mysql:5.6.23 

```

```
show VARIABLES like '%max_allowed_packet%';

show variables like '%storage_engine%';
show variables like 'collation_%';
show variables like 'character_set_%';

```
## sj迁移数据库

```
./phabricator/bin/storage dump | gzip > backup.sql.gz
```
```
zcat /path/to/file.sql.gz | mysql -uroot -pelc123
```
升级过程: https://secure.phabricator.com/book/phabricator/article/upgrading/

```
git clone https://github.com/phacility/libphutil.git stable
git clone https://github.com/phacility/arcanist.git stable
git clone https://github.com/phacility/phabricator.git stable
```


登陆:
```
mysql -h192.168.8.189 -uroot -pelc123
```
存储:
```
192.168.8.68:/data/backup/no59/mysql /data/mysql


192.168.8.68:/data/backup/no59/mysql /data/mysql           nfs     defaults        0 0
192.168.8.68:/data/backup/no75/confluence/data /data/confluence/    nfs     defaults        0 0
192.168.8.68:/data/owncloud /data/owncloud-192.168.8.68    nfs     defaults        0 0
```

# confluence安装配置

## 挂载nfs数据:
```
192.168.8.68:/data/backup/no75/confluence/data /data/confluence/    nfs     defaults        0 0
ln -s /data/confluence/conflu_data /data/conflu_data
```
这里使用从老系统迁移过来的数据.(一些文本附件)

## confluence启动

```
docker run \
-v /data/confluence/conflu_data:/var/atlassian/application-data/confluence \
-v /etc/localtime:/etc/localtime \
-v /data/confluence/server.xml:/opt/atlassian/confluence/conf/server.xml \
--restart=always \
--link mysql5:db \
--name="confluence" -d \
-p 8090:8090 \
-p 8091:8091 \
cptactionhank/atlassian-confluence
```
参考:http://wuyijun.cn/shi-yong-dockerfang-shi-an-zhuang-he-yun-xing-confluence/

## 创建数据库
```
create database confluence default character set utf8 collate utf8_bin;
grant all on confluence.* to 'confluence'@"172.17.0.%" identified by "confluenceman";
grant all on confluence.* to 'confluence'@"192.168.6.%";
grant all on confluence.* to 'confluence'@"192.168.8.%";
```

## 安装破解
```
docker cp confluence:/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.2.jar ./
mv atlassian-extras-decoder-v2-3.2.jar atlassian-extras-2.4.jar 
导出后用破机器破解

导入系统
mv atlassian-extras-2.4.jar atlassian-extras-decoder-v2-3.2.jar 
docker cp ./atlassian-extras-decoder-v2-3.2.jar  confluence:/opt/atlassian/confluence/confluence/WEB-INF/lib/  
docker stop confluence  
docker start confluence  
```


## 安装
- 1.贴上破机器的序列号
- 2.选jdbc连mysql url写:

```
jdbc:mysql://db:3306/confluence?sessionVariables=storage_engine%3DInnoDB&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8
```
- 3.导入既有的数据
参考:https://www.ilanni.com/?p=11989
如: ```xmlexport-20170902-100808-153.zip``` 这里包含了数据库数据.

- 4.安装完毕
```
管理员帐号密码登陆 http://192.168.8.189:8090
admin
Pp100admin
```
- 5.配置邮箱
这里我没用server.xml里配置(配了测试有问题),直接smtp用新浪邮箱配的
```
smtp.sina.com
lannymxl@sina.com
xatu1@
```

## confluence运维
- docker启动脚本
```
/root/dockerfile/confluence/start.sh
```
- 存储
```
192.168.8.68:/data/backup/no75/confluence/data
本地:
/data/confluence/conflu_data 软链到本地的
/data/conflu_data
```

排错:
- 1.存储nfs是否正常
- 2.mysql是否能连
```
mysql -h 192.168.8.189 -uconfluence -pconfluenceman
```







docker run -d \
    -p 9080:80 -p 9443:443 -p 9022:22 \
    --env PHABRICATOR_HOST=sj.pp100.net \
    --env MYSQL_HOST=192.168.8.189 \
    --env MYSQL_USER=root \
    --env MYSQL_PASS=elc123 \
    --env PHABRICATOR_REPOSITORY_PATH=/repos \
    --env PHABRICATOR_HOST_KEYS_PATH=/hostkeys/persisted \
    -v /data/phabricator/hostkeys:/hostkeys \
    -v /data/phabricator/repo:/repos \
   redpointgames/phabricator



[root@test2 phabricator]# bin/repository list-paths 
+==============+========================+
| Repository   | Path                   |
+==============+========================+
| rCALLCENTER  | /var/repo/CALLCENTER/  |
| rAPIDESIGN   | /var/repo/APIDESIGN/   |
| rBI          | /var/repo/BI/          |
| rBBS         | /var/repo/BBS/         |
| rDATAACCESS  | /var/repo/DATAACCESS/  |
| rAPIDATA     | /var/repo/APIDATA/     |
| rPLAYWEB     | /var/repo/PLAYWEB/     |
| rWEBB        | /var/repo/WEBB/        |
| rPOSTGRESQL  | /var/repo/POSTGRESQL/  |
| rMYCATSERVER | /var/repo/MYCATSERVER/ |
| rMYCAT       | /var/repo/MYCAT/       |
| rCODE        | /var/repo/CODE/        |
+==============+========================+




docker run -d \
-p "8080:80" \
-v /etc/localtime:/etc/localtime \
-e "SUBMIN_HOSTNAME=code.pp100.net" \
-e "SUBMIN_EXTERNAL_PORT=8080" \
thaim/submin





sj迁移:
http://m.blog.csdn.net/littlebrain4solving/article/details/77368731
https://hub.docker.com/r/redpointgames/phabricator/
https://secure.phabricator.com/book/phabricator/article/upgrading/
http://blog.csdn.net/fengjingge/article/details/52130838
http://blog.topspeedsnail.com/archives/7436
https://blog.chengchang.me/2014/07/11/migrating-and-updating-phabricator/

svn图形化管理界面:
submin  http://code.pp100.net:8080/submin/users/show/admin

https://www.lezhizhe.net/archives/325/
https://www.ilanni.com/?p=11720
https://hub.docker.com/r/tragus/webmin/


nginx stream模块:
http://blog.csdn.net/zhiyuan_2007/article/details/71238216
http://nginx.org/en/docs/stream/ngx_stream_core_module.html
http://danchaofan.blog.51cto.com/1196121/1826732


docker run --name lb-nginx -d -v /etc/nginx/nginx.conf:/etc/nginx/nginx.conf:ro --net=host --restart=always -v /etc/localtime:/etc/localtime nginx:1.13.3-alpine

数据目录:
/usr/share/nginx/html/index.html

/usr/share/nginx/html
